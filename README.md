# Загрузка данных по деталям от поставщиков
Чтение сообщений с вложениями csv из почтового ящика по протоколу IMAP с последующей загрузкой в БД. Реализовано на FastApi с использованием асинхронной библиотеки aioimaplib

## Конфигурация
Настроить конфигурацию можно в файле .env. Тут настраивается:<br>
-настройки для подключения к БД<br>
-креды для работы с ПЯ (ПЯ, сервер, пароль)<br>
Пример:<br>
APP_CONFIG__MAIL__SERVER="imap.yandex.ru"<br>
APP_CONFIG__MAIL__LOGIN="user@yandex.ru"<br>
APP_CONFIG__MAIL__PASSWORD="password"<br>


### Запуск приложения
-Приложение и бд готовы к запуску в докер контейнерах, для этого необходимо сконфигурировать файл .env и выполнить команду docker compose up -d (приложение станет доступно по адресу http://localhost:8080/docs)<br>
-Возможен запуск отдельного контейнера для БД (через docker compose up db) и запуск main.py в папке проекта<br>
-После старта приложения необходимо загрузить файл с конфигурациями отправителей в базу данных (http://localhost:8000/manager/upload-csv/). Пример файла csv - config_data.csv в корне проекта.<br>

Пример заполнения файла csv:<br>
sender;vendor;number;description;price;count<br>
vitalyl87@yandex.ru;Бренд;Каталожный номер;Описание;Цена, руб.;Наличие<br>
some@mail.ru;Вендор;Кат. номер;Описане;Цена;Кол-во<br><br>

Тут в БД будут загружены 2 конфигурации для some@mail.ru и vitalyl87@yandex.ru<br>

### Описание эндпоинтов
-/manager/upload-csv/ загрузка файла конфигурации csv в базу данных<br>
-/manager/senders/ вывод ПЯ отправителей из базы данных<br>
-/manager/configurations/ вывод конфигураций для ПЯ отправителей из базы данных<br>
-/shop/ загрузка деталей из ПЯ по протоколу IMAP<br>


#### Исходник задания
На почтовый ящик компании "ООО "Запчасти даром" приходит прайс-лист от поставщика "ООО "Доставим в срок"
Прайс-лист представляет из себя csv файл, образец которого во вложении. В прайсе содержится информация об автозапчастях, которые доставляет поставщик.
Необходимо написать web приложение, которое скачивает прайс с почтового ящика и загружает в базу.

Входные данные.<br>

Необходимо загрузить в таблицу PriceItems БД (любую реляционную) со структурой<br>
	- Vendor varchar(64) - производитель
	- Number varchar(64) - номер запчасти
	- SearchVendor varchar(64) - производитель для поиска
	- SearchNumber varchar(64) - номер для поиска
	- Description varchar(512) - наименование
	- Price decimal(18,2) - цена
	- Count int - количество

Данные из прайс листа, но только определенные колонки.
Нужные колонки из файла:
	- "Бренд" загрузить в Vendor
	- "Каталожный номер" загрузить в Number
	- "Описание" загрузить в Description
	- "Цена" в Price
	- "Наличие" в Count


При выполнении задания следует учесть:
	- компании "ООО "Запчасти даром" присылают прайсы несколько поставщиков, поэтому порядок колонок и их наименование
	в прайсе может меняться, поэтому сопоставление колонок нужно конфигурировать в зависимости от поставщика. В данном случае
	достаточно одной конфигурации под поставщика "ООО "Доставим в срок"
	- почтовый ящик так же должен конфигурироваться (использовать протокол IMAP для получения письма).
	Прайс-лист будет вложением к письму, при чем имя файла не регламентировано, известно только, что расширение .csv
	- при загрузке в базу следует заполнить поля SearchVendor и SearchNumber путем удаления из них всех нецифернобуквенных символов
	и преобразования к верхнему регистру символов полей Vendor и Number соответственно
	- колонка с количеством может содержать в себе записи вида >10, <13, 10-50. В первом случае нужно загрузить просто 10 и 13, во втором 50
	- колонка "Описание" может содержать более 512 символов, в таком случае необходимо ее обрезать до 512
